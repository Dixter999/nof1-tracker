---
name: Pydantic configuration module
status: open
created: 2025-12-02T13:25:20Z
updated: 2025-12-02T13:25:20Z
github: "[Will be updated when synced to GitHub]"
depends_on: [001]
parallel: true
conflicts_with: []
---

# Task: Pydantic configuration module

## Description

Implement the configuration management module using Pydantic Settings. This provides type-safe configuration loading from environment variables with validation, covering database settings, scraper settings, and application settings.

## TDD Requirements

**This project uses Test-Driven Development. You MUST:**
1. ðŸ”´ RED: Write failing tests for configuration loading and validation
2. ðŸŸ¢ GREEN: Implement Pydantic settings classes
3. ðŸ”µ REFACTOR: Add validators, clean up types

See `.claude/rules/tdd.enforcement.md` for complete requirements.

## Acceptance Criteria

- [ ] `DatabaseSettings` class with:
  - Fields: host, port, name, user, password, pool_size, max_overflow
  - Validators for pool_size > 0 and max_overflow >= 0
  - Properties: url, async_url for connection strings
- [ ] `ScraperSettings` class with:
  - Fields: headless, timeout, rate_limit
  - Appropriate defaults
- [ ] `AppSettings` class with:
  - Fields: log_level, refresh_interval
- [ ] Environment variable loading from .env file
- [ ] Singleton instances for easy import
- [ ] All settings have sensible defaults
- [ ] Validation errors are descriptive

## Technical Details

### File Location
`src/nof1_tracker/database/config.py`

### Environment Variable Mapping
```python
# DatabaseSettings
NOF1_DB_HOST -> host (default: "localhost")
NOF1_DB_PORT -> port (default: 5432)
NOF1_DB_NAME -> name (default: "nof1_tracker")
NOF1_DB_USER -> user (default: "nof1_user")
NOF1_DB_PASSWORD -> password (default: "")
NOF1_DB_POOL_SIZE -> pool_size (default: 5)
NOF1_DB_MAX_OVERFLOW -> max_overflow (default: 10)

# ScraperSettings
SCRAPER_HEADLESS -> headless (default: True)
SCRAPER_TIMEOUT -> timeout (default: 30000)
SCRAPER_RATE_LIMIT -> rate_limit (default: 30)

# AppSettings
LOG_LEVEL -> log_level (default: "INFO")
REFRESH_INTERVAL -> refresh_interval (default: 15)
```

### URL Generation
- `url`: `postgresql://{user}:{password}@{host}:{port}/{name}`
- `async_url`: `postgresql+asyncpg://{user}:{password}@{host}:{port}/{name}`

## Test Cases

1. `test_database_settings_defaults` - verify default values
2. `test_database_settings_from_env` - load from environment
3. `test_database_url_generation` - URL property works
4. `test_pool_size_validation` - pool_size must be > 0
5. `test_max_overflow_validation` - max_overflow must be >= 0
6. `test_scraper_settings_defaults` - verify scraper defaults
7. `test_app_settings_defaults` - verify app defaults

## Dependencies

- [ ] Task 001: Project scaffolding (for package structure)
- [ ] External: pydantic, pydantic-settings

## Effort Estimate

- Size: S
- Hours: 2-3 hours
- Parallel: true (can run alongside 004)

## Definition of Done

- [ ] Tests written FIRST (RED phase) - tests/test_database/test_config.py
- [ ] Code implemented (GREEN phase) - config.py complete
- [ ] Code refactored (REFACTOR phase) - clean validators
- [ ] All tests passing
- [ ] Type hints complete
- [ ] Docstrings for all classes and methods
- [ ] Black/Ruff linters pass
- [ ] mypy type checking passes

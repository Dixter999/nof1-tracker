---
name: Docker and PostgreSQL setup
status: open
created: 2025-12-02T13:25:20Z
updated: 2025-12-02T13:25:20Z
github: https://github.com/Dixter999/nof1-tracker/issues/4
depends_on: [001]
parallel: false
conflicts_with: []
---

# Task: Docker and PostgreSQL setup

## Description

Create Docker configuration for local development including docker-compose.yml with PostgreSQL 16 service, Dockerfile for the Python application, and initial SQL setup script. This enables containerized development with proper database infrastructure.

## TDD Requirements

**This project uses Test-Driven Development. You MUST:**
1. ðŸ”´ RED: Write failing test first (test Docker compose validates, PostgreSQL connects)
2. ðŸŸ¢ GREEN: Create Docker files to pass tests
3. ðŸ”µ REFACTOR: Optimize Dockerfile layers, add health checks

See `.claude/rules/tdd.enforcement.md` for complete requirements.

## Acceptance Criteria

- [ ] `docker-compose.yml` with services:
  - `postgres`: PostgreSQL 16-alpine with health check
  - `app`: Python application container
  - `scraper`: On-demand scraper service (profile: scraper)
  - `monitor`: Continuous monitoring service (profile: monitor)
- [ ] `Dockerfile` with:
  - Python 3.12-slim base image
  - System dependencies (libpq-dev, gcc)
  - Playwright browser installation
  - Proper PYTHONPATH configuration
- [ ] `migrations/init/001_init.sql` with PostgreSQL enum types
- [ ] `docker compose up postgres` starts successfully
- [ ] `docker compose up app` connects to database
- [ ] Health checks are functional
- [ ] Volume persistence for PostgreSQL data

## Technical Details

### docker-compose.yml Services

**postgres:**
- Image: postgres:16-alpine
- Environment from .env file
- Health check: pg_isready
- Named volume: postgres_data

**app:**
- Build from Dockerfile
- Depends on postgres (healthy)
- Volume mount for source code
- Environment override for DB host

**scraper/monitor:**
- Profile-based (not started by default)
- Same build as app
- Specific commands for each service

### Dockerfile Optimization
- Multi-stage build consideration
- Layer caching for dependencies
- Non-root user for security
- Minimal image size

### Initial SQL Script
Create enum types:
- season_status: active, completed, cancelled
- trade_side: long, short
- trade_status: open, closed, liquidated
- chat_decision: buy, sell, hold, close, none

## Dependencies

- [ ] Task 001: Project scaffolding (for pyproject.toml)
- [ ] External: Docker, Docker Compose

## Effort Estimate

- Size: M
- Hours: 3-4 hours
- Parallel: false (depends on 001)

## Definition of Done

- [ ] Tests written FIRST (RED phase) - test_docker_setup.py
- [ ] Code implemented (GREEN phase) - all Docker files created
- [ ] Code refactored (REFACTOR phase) - optimized layers
- [ ] All tests passing
- [ ] `docker compose config` validates successfully
- [ ] `docker compose up postgres -d` starts database
- [ ] `docker compose up app` connects and exits cleanly
- [ ] Health checks report healthy status
